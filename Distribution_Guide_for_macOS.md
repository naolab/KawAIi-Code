# macOSユーザー向け配布ガイド

このドキュメントは、AI-Kawaii-Project を他の macOS ユーザーが利用できるようにするための、現状の問題点と改善案をまとめたものです。

---

## 1. 現状の問題点

現在、このアプリケーションを他の macOS ユーザーが利用できるようにするには、以下の主要な問題点があります。

### 1.1. AivisSpeech Engine (音声合成エンジン) の配布とセットアップ
*   **問題点**: アプリケーションの音声読み上げ機能は、ユーザーのローカルマシンで別途起動している `AivisSpeech Engine` (`http://127.0.0.1:10101`) に依存しています。このエンジンのダウンロード、インストール、起動方法が明確でなく、ポートが競合する可能性もあります。

### 1.2. Next.jsアプリケーション (VRMビューワー) の配布とセットアップ
*   **✅ 解決済み**: VRMモデルを表示するビューワーは、静的ファイルとしてElectronアプリに統合済みです。ユーザーは個別にNext.jsサーバーを起動する必要がありません。

### 1.3. Electronアプリケーションのパッケージング
*   **問題点**: Electron アプリケーションを他のユーザーに配布するためのインストーラー (macOS の `.dmg` ファイルなど) を作成する設定がありません。現状では、ユーザーはソースコードをクローンして自分でビルド・実行する必要があります。

### 1.4. 依存関係の管理と初期設定
*   **問題点**: アプリケーションは Node.js および npm パッケージに依存しており、ユーザーは手動で Node.js をインストールし、必要なディレクトリで `npm install` を実行する必要があります。

### 1.5. 環境設定とパスの問題
*   **問題点**: 壁紙ファイルや VRM モデルファイルなど、アプリが特定のファイルパスに依存している可能性があり、異なる環境で正しく動作しない可能性があります。

---

## 2. 改善案

上記の問題点を解決し、ユーザーがアプリを簡単に利用できるようにするための改善案を提案します。

### 2.1. AivisSpeech Engine (音声合成エンジン) の配布とセットアップ

*   **詳細なドキュメントの提供**:
    *   `README.md` または専用の `Aivis_Speech_Engine_Setup_Guide.md` を作成し、AivisSpeech Engine のダウンロード元、macOS でのインストール手順、および起動コマンドを明確に記載します。
    *   **ポート競合対策**: AivisSpeech Engine がポート番号を変更できる場合は、その設定方法も記載し、ユーザーが手動で対応できるように案内します。
*   **（長期的には）バンドルまたは自動起動の検討**:
    *   可能であれば、AivisSpeech Engine を Electron アプリケーションのインストーラーに含めるか、アプリ起動時に AivisSpeech Engine をバックグラウンドで自動的に起動・停止するスクリプトを Electron アプリ内に組み込むことを検討します。ただし、これはライセンスや技術的な複雑さに依存します。

### 2.2. Next.jsアプリケーション (VRMビューワー) の配布とセットアップ

*   **✅ 完了済み - Electron への同梱**:
    *   Next.js アプリケーションを静的ファイルとしてビルドし、Electron アプリケーション内に統合しました。
    *   **実装済みの内容**:
        1.  `ai-kawaii-nextjs/out` の静的ファイルを `src/vrm-viewer/` にコピー
        2.  `src/index.html` のiframe参照先を `./vrm-viewer/index.html` に変更
        3.  絶対パス(`/_next/static/`)を相対パス(`./_next/static/`)に一括修正
        4.  webpack公開パスを `"./_next/"` に修正
        5.  VRMファイル、アニメーションファイル、画像ファイルのパスを相対パスに修正
        6.  postMessageのtargetOriginを `file://` プロトコル対応に修正
    *   **結果**: ユーザーは Next.js サーバーを個別に起動することなく、VRMキャラクターの表示、アニメーション、口パク機能が正常に動作します。

### 2.3. Electronアプリケーションのパッケージング

*   **`electron-builder` の導入**:
    *   `electron-builder` (または `electron-packager`) のようなツールをプロジェクトに導入し、macOS 向けのインストーラー (`.dmg`) を作成します。
    *   **手順例**:
        1.  `npm install electron-builder --save-dev` を実行します。
        2.  `package.json` に `build` 設定を追加し、どのファイルをバンドルするか、出力形式などを指定します。
        3.  `npm run dist` (または `npm run package`) のようなビルドスクリプトを `package.json` に追加します。
        4.  これにより、簡単なコマンドで、ユーザーがダウンロードしてダブルクリックするだけでインストールできる配布物を作成できるようになります。

### 2.4. 依存関係の管理と初期設定

*   **`electron-builder` による自動解決**:
    *   `electron-builder` を導入すれば、プロジェクトの `package.json` に記載された `dependencies` は自動的にバンドルされるため、ユーザーが手動で `npm install` を実行する必要はなくなります。
*   **README の更新**:
    *   プロジェクトの `README.md` を更新し、Node.js のインストール（もし必要なら）、およびアプリのインストール（`.dmg` ファイルを使用）といった、簡素化されたセットアップ手順を記載します。

### 2.5. 環境設定とパスの問題

*   **Electron API の利用**:
    *   壁紙や VRM モデルなどのアセットへのパスは、Electron の提供する API (例: `app.getPath('userData')`, `app.getAppPath()`) を使用して、OS に依存しない形で指定するようにコードを修正します。
*   **アセットのバンドル**:
    *   `electron-builder` の設定で、必要なアセットファイル (壁紙画像、VRM モデルデータなど) が適切にパッケージングされるように指定し、アプリ内部からアクセスできるようにします。

---

## 3. 現在の進捗状況と次のステップ

### 3.1. 完了済みの作業
- **✅ VRMビューワーの統合**: Next.jsアプリケーションを静的ファイル化してElectronアプリに完全統合
- **✅ 依存関係の削減**: 外部Next.jsサーバーの起動が不要になり、ユーザビリティが大幅に向上
- **✅ ファイルパスの修正**: 相対パス化によりfile://プロトコルでの動作を実現
- **✅ 機能の動作確認**: VRMキャラクター表示、アニメーション、口パク機能が正常動作

### 3.2. 次に実装すべき項目（優先度順）

#### 高優先度
1. **electron-builderによるパッケージング**
   - `.dmg`インストーラーの作成
   - アセットファイルの適切なバンドル設定
   - 配布用ビルドスクリプトの整備

2. **Electron APIを使用したパス管理**
   - `app.getPath()` APIを使用した環境非依存のパス管理
   - 壁紙・VRMモデルファイルの適切な配置

#### 中優先度
3. **AivisSpeech Engineの統合検討**
   - セットアップガイドの詳細化
   - 可能であれば自動起動スクリプトの組み込み

4. **配布用ドキュメントの整備**
   - ユーザー向けインストールガイドの作成
   - システム要件の明記

### 3.3. 技術的な残課題
- Content Security Policy (CSP) の最適化
- Electronセキュリティ警告の対応（本番パッケージで自動解決）
- アセットファイルのバンドル設定の確認

これらの改善案を段階的に適用していくことで、他の macOS ユーザーが AI-Kawaii-Project をより簡単にインストールし、利用できるようになるでしょう。