<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' file: data:; script-src 'self' https://unpkg.com https://cdn.skypack.dev https://cdn.jsdelivr.net https://threejs.org; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src-elem 'self' 'unsafe-inline' https://cdn.jsdelivr.net; frame-src 'self'; child-src 'self'; connect-src 'self' http://localhost:10101 ws://localhost:8080 https://api.aivis-project.com; media-src 'self' blob: data:;">
    <title>KawAIi Code</title>
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="icon" href="./assets/icons/favicon.ico" type="image/x-icon">
    <!-- xterm.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.css" />
    <!-- Loading Screen -->
    <script src="./components/LoadingScreen.js"></script>
</head>
<body>
    <!-- AI選択モーダル -->
    <div id="ai-select-modal" class="settings-modal" style="display: none;">
        <div class="settings-content">
            <div class="settings-header">
                <h3>AIアシスタントを選択</h3>
                <button id="close-ai-select" class="close-btn">×</button>
            </div>
            <div class="settings-body" style="text-align: center; padding: 30px;">
                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <button id="start-claude" class="simple-btn" style="width: 140px; background-color: #ff6b35;">Claude Code</button>
                    <button id="start-claude-dangerous" class="simple-btn" style="width: 170px; background-color: #ff3535;">Claude Code (Dangerous)</button>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <div class="header">
            <div class="header-left">
                <button id="settings-btn" class="settings-btn" aria-label="設定を開く">
                    <span class="gear-horizontal"></span>
                    <span class="gear-diagonal"></span>
                    <span class="gear-diagonal"></span>
                    <span class="gear-diagonal"></span>
                    <span class="gear-diagonal"></span>
                </button>
                <!-- 会話ログボタン（一時的に無効化）
                <button id="debug-stats-btn" class="settings-btn history-btn" aria-label="会話ログを表示" title="会話ログ">
                    <span class="clock-hand-short"></span>
                    <span class="clock-hand-long"></span>
                </button>
                -->
                <button id="help-btn" class="settings-btn help-btn" aria-label="使い方を見る">
                </button>
            </div>
            <div class="controls">
                <button id="terminal-toggle" class="simple-btn terminal-toggle-btn" aria-label="ターミナル表示切り替え">
                    <span class="pupil"></span>
                </button>
                <button id="start-ai-selection" class="simple-btn start-btn" aria-label="AIアシスタントを開始"></button>
                <button id="stop-terminal" class="simple-btn stop-btn" aria-label="AIアシスタントを停止"></button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="terminal-section">
                <!-- タブバー -->
                <div id="tab-bar" class="tab-bar">
                    <!-- タブは動的に追加される -->
                    <button id="new-tab-button" class="new-tab-button" title="新しいタブを作成">+</button>
                </div>
                
                <!-- ターミナルコンテナ -->
                <div id="terminal-container" class="terminal-container">
                    <div id="terminal" class="terminal-wrapper active"></div>
                </div>
            </div>
            
            <div class="character-section">
                <div class="character-main">
                    <iframe id="vrm-iframe" 
                            src="../ai-kawaii-nextjs/out/index.html" 
                            style="width: 100%; height: calc(100% + 70px); border: none; background: transparent; border-radius: 20px; margin-top: -70px;"
                            allow="accelerometer; gyroscope">
                    </iframe>
                </div>
            </div>
        </div>
        
        
        
        <!-- 設定画面 -->
        <div id="settings-modal" class="settings-modal" style="display: none;">
            <div class="settings-content">
                <div class="settings-header">
                    <h3>設定</h3>
                    <button id="close-settings" class="close-btn">×</button>
                </div>
                <div class="settings-body">
                    <div class="setting-group">
                        <label for="voice-toggle-modal">音声読み上げ</label>
                        <input type="checkbox" id="voice-toggle-modal">
                    </div>
                    
                    <div class="setting-group">
                        <label for="use-hooks-toggle">Claude Code Hooksで読み上げ</label>
                        <div class="setting-switch">
                            <input type="checkbox" id="use-hooks-toggle">
                            <label for="use-hooks-toggle" class="switch-label"></label>
                        </div>
                        <div style="margin-top: 5px; margin-bottom: 8px;">
                            <span style="color: #ff6b35; font-size: 12px; font-weight: 500;">⚠️ この機能は現在開発中のため使用できません</span>
                        </div>
                        <div style="margin-top: 5px;">
                            <button id="hooks-info-btn" class="simple-btn" style="width: auto; min-width: 120px; opacity: 0.5; cursor: not-allowed;" disabled>この機能について</button>
                        </div>
                    </div>
                    
                    <!-- Aivis Cloud API設定セクション -->
                    <div class="setting-group">
                        <label for="use-cloud-api-toggle">Aivis Cloud APIを使用</label>
                        <div class="setting-switch">
                            <input type="checkbox" id="use-cloud-api-toggle">
                            <label for="use-cloud-api-toggle" class="switch-label"></label>
                        </div>
                        
                        <div id="cloud-api-settings" style="display: none;">
                            <div class="setting-item" style="margin-bottom: 12px;">
                                <label for="cloud-api-key-input" style="display: block; margin-bottom: 5px; font-size: 13px;">APIキー</label>
                                <input type="password" id="cloud-api-key-input" placeholder="APIキーを入力" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            
                            <div style="display: flex; gap: 10px;">
                                <button id="test-cloud-api-btn" class="simple-btn" style="flex: 1;">接続テスト</button>
                                <button id="save-cloud-api-btn" class="simple-btn" style="flex: 1;">保存</button>
                            </div>
                            
                            <div id="cloud-api-status" style="margin-top: 10px; font-size: 12px; padding: 8px; border-radius: 4px; display: none;"></div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="speaker-select-modal">話者選択</label>
                        <select id="speaker-select-modal" class="speaker-select">
                            <option value="0">話者を選択...</option>
                        </select>
                    </div>
                    
                    <div class="setting-group connection-status-group">
                        <span>音声エンジン接続状況</span>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span id="connection-status-modal">接続確認中...</span>
                            <button id="refresh-connection-modal" class="simple-btn">再接続</button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="voice-interval-slider">読み上げ間隔</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 12px; color: #666;">短い</span>
                            <input type="range" id="voice-interval-slider" min="0" max="6" step="0.5" value="0.5" style="flex: 1;">
                            <span style="font-size: 12px; color: #666;">長い</span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="voice-volume-slider">音量調整</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 12px; color: #666;">小</span>
                            <input type="range" id="voice-volume-slider" min="0" max="100" step="5" value="50" style="flex: 1;">
                            <span style="font-size: 12px; color: #666;">大</span>
                        </div>
                    </div>
                    
                    <!-- Claude Code 作業ディレクトリ設定セクション -->
                    <div class="setting-group">
                        <label>作業ディレクトリ設定</label>
                        <div class="claude-cwd-controls" style="display: flex; flex-direction: column; gap: 8px;">
                            <span id="claude-cwd-display" style="font-size: 13px; color: #555; word-break: break-all; min-height: 20px;">読み込み中...</span>
                            <button id="select-claude-cwd-btn" class="simple-btn">作業ディレクトリを選択</button>
                            <div id="claude-cwd-message" style="font-size: 12px; margin-top: 5px; min-height: 15px;"></div>
                        </div>
                    </div>
                    
                    <!-- CLAUDE.md設定セクション -->
                    <div class="setting-group">
                        <label>CLAUDE.md設定</label>
                        
                        <!-- 生成先表示 -->
                        <div class="setting-item" style="margin-top: 8px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 13px;">生成先</label>
                            <div style="padding: 8px 12px; background: #f0f0f0; border-radius: 4px; font-size: 13px; color: #666; word-break: break-all;">
                                <span id="workspace-path-display">読み込み中...</span>
                            </div>
                        </div>
                        
                        <!-- 操作ボタン群 -->
                        <div class="claude-md-action-buttons" style="display: flex; gap: 6px; margin-top: 10px;">
                            <button id="claude-md-generate-btn" class="simple-btn" style="flex: 1; min-width: 100px;">生成</button>
                            <button id="claude-md-info-btn" class="simple-btn" style="flex: 1; min-width: 120px;">この機能について</button>
                        </div>
                        
                        <!-- 内容編集エリア -->
                        <div class="setting-item" style="margin-top: 10px;">
                            <label for="claude-md-content-editor" style="display: block; margin-bottom: 5px; font-size: 13px;">CLAUDE.md内容</label>
                            <textarea id="claude-md-content-editor" 
                                      style="width: 100%; height: 300px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 12px; resize: vertical;"
                                      placeholder="CLAUDE.mdの内容を編集してください..."></textarea>
                        </div>
                        
                        <!-- 読み込みボタン群 -->
                        <div class="claude-md-load-buttons" style="display: flex; gap: 6px; margin-top: 10px;">
                            <button id="claude-md-load-btn" class="simple-btn" style="flex: 1; min-width: 140px;">現在の内容を読み込み</button>
                            <button id="claude-md-default-btn" class="simple-btn" style="flex: 1; min-width: 140px;">デフォルト内容を読み込み</button>
                        </div>
                    </div>
                    
                    <!-- 壁紙設定セクション -->
                    <div class="setting-group">
                        <label>壁紙設定</label>
                        <div class="wallpaper-controls" style="display: flex; flex-direction: column; gap: 10px;">
                            <label class="radio-label">
                                <input type="radio" name="wallpaper-option" id="wallpaper-default-radio" value="default">
                                <span>デフォルト壁紙を使用する</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="wallpaper-option" id="wallpaper-uploaded-radio" value="uploaded">
                                <span>アップロードした壁紙を使用する</span>
                            </label>
                            <input type="file" id="wallpaper-upload" accept="image/*" style="display: none;">
                            <button id="upload-wallpaper-btn" class="simple-btn" style="width: auto;">壁紙をアップロード</button>
                            <!-- アップロードした壁紙の名前を表示する要素を追加 -->
                            <span id="uploaded-wallpaper-name" style="font-size: 13px; color: #555; word-break: break-all; min-height: 20px;"></span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="wallpaper-animation-toggle">デフォルト壁紙のアニメーション</label>
                        <div class="setting-switch">
                            <input type="checkbox" id="wallpaper-animation-toggle">
                            <label for="wallpaper-animation-toggle" class="switch-label"></label>
                        </div>
                    </div>
                    
                    <!-- アプリについて -->
                    <div class="setting-group">
                        <label>アプリについて</label>
                        <div style="font-size: 13px; color: #ff6b35; margin-top: 5px; font-weight: 500;">
                            バージョン: 開発版（ベータ）
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ヘルプ・使い方ガイド -->
        <div id="help-modal" class="help-modal" style="display: none;">
            <div class="help-content-sidebar">
                <div class="help-header">
                    <h3>使い方ガイド</h3>
                    <button id="close-help" class="close-btn">×</button>
                </div>
                <div class="help-main-container">
                    <!-- サイドバー -->
                    <div class="help-sidebar">
                        <nav class="help-nav">
                            <a href="#" class="help-nav-item active" data-section="quickstart">
                                クイックスタート
                            </a>
                            <a href="#" class="help-nav-item" data-section="voice">
                                音声機能
                            </a>
                            <a href="#" class="help-nav-item" data-section="character">
                                VRMキャラクター
                            </a>
                            <a href="#" class="help-nav-item" data-section="claude">
                                Claude Code機能
                            </a>
                            <a href="#" class="help-nav-item" data-section="customize">
                                カスタマイズ
                            </a>
                            <a href="#" class="help-nav-item" data-section="controls">
                                操作ボタン
                            </a>
                            <a href="#" class="help-nav-item" data-section="contact">
                                お問い合わせ
                            </a>
                            <a href="#" class="help-nav-item" data-section="license">
                                ライセンス
                            </a>
                            <a href="#" class="help-nav-item" data-section="privacy">
                                プライバシーポリシー
                            </a>
                            <a href="#" class="help-nav-item" data-section="terms">
                                利用規約
                            </a>
                            <a href="#" class="help-nav-item" data-section="updates">
                                アップデート情報
                            </a>
                        </nav>
                    </div>
                    
                    <!-- メインコンテンツ -->
                    <div class="help-content-main">
                        <!-- クイックスタート -->
                        <div id="help-section-quickstart" class="help-section active">
                            <h2>クイックスタート</h2>
                            <div class="help-item">
                                <h3>最初のAI会話</h3>
                                <ol>
                                    <li><strong>開始ボタン</strong>（右向き三角形）をクリック</li>
                                    <li>ターミナル画面でClaude Codeと対話開始</li>
                                    <li>右側の3Dキャラクター（モネちゃん）がAIの返答に合わせて表情変化</li>
                                </ol>
                            </div>
                            <div class="help-item">
                                <h3>音声機能を有効にする（オプション）</h3>
                                <p>音声機能を有効にすると、キャラクターが返答を読み上げます。感情に応じた自然な表情変化を楽しめます。</p>
                            </div>
                        </div>

                        <!-- 音声機能 -->
                        <div id="help-section-voice" class="help-section">
                            <h2>音声機能</h2>
                            <div class="help-item">
                                <h3>AivisSpeech Engine（ローカル）</h3>
                                <p><a href="https://aivis-project.com/" target="_blank">AivisSpeech公式サイト</a>からAivisSpeech Engineをダウンロード・インストールしてください。Engine起動後（ポート: 127.0.0.1:10101）、KawAIi Codeで音声機能が自動的に有効化されます。</p>
                            </div>
                            <div class="help-item">
                                <h3>Aivis Cloud API（クラウド）</h3>
                                <p>設定画面から「クラウドAPI使用」を有効化し、Aivis Cloud APIキーを設定してください。インターネット経由で高品質な音声合成を利用できます。ローカルソフト不要でシステムリソース使用量が少ないのが利点です。</p>
                            </div>
                        </div>

                        <!-- VRMキャラクター -->
                        <div id="help-section-character" class="help-section">
                            <h2>VRMキャラクター</h2>
                            <div class="help-item">
                                <h3>デフォルトキャラクター</h3>
                                <p>モネちゃんは照れ屋で優しいプログラミングアシスタントです。AI応答の感情に合わせて表情が自動変更され、待機中も自然な動作をします。</p>
                            </div>
                            <div class="help-item">
                                <h3>カスタムキャラクター</h3>
                                <p>右上の設定ボタンをクリックし、「VRMファイルを選択」からお好みの.vrmファイルを選択できます。VRM 0.x（フル対応）、VRM 1.0（基本対応）に対応しており、ファイルサイズは50MB以下を推奨しています。</p>
                            </div>
                            <div class="help-item">
                                <h3>表情・動作機能</h3>
                                <table>
                                    <tr><th>AI応答内容</th><th>表情変化</th></tr>
                                    <tr><td>成功・完了</td><td>喜び</td></tr>
                                    <tr><td>エラー・失敗</td><td>困った表情</td></tr>
                                    <tr><td>説明・解説</td><td>真剣な表情</td></tr>
                                    <tr><td>褒められた時</td><td>照れ</td></tr>
                                </table>
                                <p>音声連動機能により、LipSync（音声再生時の口の動き）と自然な表情変化が実現されています。</p>
                            </div>
                        </div>

                        <!-- Claude Code機能 -->
                        <div id="help-section-claude" class="help-section">
                            <h2>Claude Code機能</h2>
                            <div class="help-item">
                                <h3>通常モード</h3>
                                <p>一般的なプログラミング支援、コードレビューに使用します。安全性重視で権限チェックありのため、通常の開発作業全般に推奨されます。</p>
                            </div>
                            <div class="help-item">
                                <h3>Dangerousモード</h3>
                                <p>システム設定変更、高度な操作に使用します。権限チェックをスキップしてより自由度が高い操作が可能ですが、上級者向けのため慎重に使用してください。</p>
                            </div>
                            <div class="help-item">
                                <h3>CLAUDE.md設定（手動）</h3>
                                <p>Claude Codeにモネの魂を吹き込むため、作業ディレクトリにCLAUDE.mdファイルを生成する必要があります。このファイルがないと音声読み上げ機能（『』で囲まれた部分の読み上げ）が正常に動作しません。</p>
                                <p>キャラクター設定は自由に変更できますが、このアプリはモネを想定して作られているため（表情連動など）、他のキャラクター設定では一部機能が正常に動作しない可能性があります。</p>
                                <p>設定画面からCLAUDE.mdの内容を編集し、「生成」ボタンで作業ディレクトリに作成できます。</p>
                            </div>
                        </div>

                        <!-- カスタマイズ -->
                        <div id="help-section-customize" class="help-section">
                            <h2>カスタマイズ</h2>
                            <div class="help-item">
                                <h3>壁紙システム</h3>
                                <p>時間帯に応じて自動で壁紙が切り替わります。朝（6-12時）は爽やかなブルー系、昼（12-18時）は明るいイエロー系、夕（18-21時）は温かなオレンジ系、夜（21-6時）は落ち着いたパープル系になります。</p>
                                <p>設定画面から「壁紙アップロード」でカスタム壁紙を設定できます。JPG、PNG、MP4（動画壁紙）に対応しており、推奨解像度は1920x1080以上です。</p>
                            </div>
                            <div class="help-item">
                                <h3>ターミナル設定</h3>
                                <p>最大4つのターミナルを同時実行できるタブ機能があります。眼のアイコンで表示/非表示を切り替え、フォントサイズは設定画面で調整可能です。</p>
                            </div>
                            <div class="help-item">
                                <h3>プロジェクト設定</h3>
                                <p>プロジェクトごとに異なる作業ディレクトリを設定できます。CLAUDE.mdは設定画面で内容を編集し手動で生成、キャラクター設定もプロジェクト別に割り当て可能です。</p>
                            </div>
                        </div>

                        <!-- 操作ボタン -->
                        <div id="help-section-controls" class="help-section">
                            <h2>操作ボタン</h2>
                            <div class="help-item">
                                <table>
                                    <tr><th>ボタン</th><th>機能</th></tr>
                                    <tr><td><strong>開始ボタン</strong></td><td>Claude Codeを起動</td></tr>
                                    <tr><td><strong>停止ボタン</strong></td><td>Claude Codeを停止</td></tr>
                                    <tr><td><strong>表示切り替え</strong></td><td>ターミナル表示/非表示</td></tr>
                                    <tr><td><strong>設定ボタン</strong></td><td>音声・VRM・壁紙・ディレクトリ設定</td></tr>
                                    <tr><td><strong>ヘルプボタン</strong></td><td>この使い方ガイドを表示</td></tr>
                                </table>
                            </div>
                        </div>

                        <!-- お問い合わせ -->
                        <div id="help-section-contact" class="help-section">
                            <h2>お問い合わせ</h2>
                            <div class="help-item">
                                <h3>カジュアルな質問・感想</h3>
                                <p>アプリについての感想や気軽な質問は、開発者のX (Twitter) へDMでお気軽にお送りください。</p>
                                <div style="margin: 10px 0;">
                                    <a href="https://x.com/nao_u7589422" target="_blank" style="color: #ff6b35; text-decoration: none; font-weight: 500;">
                                        @nao_u7589422 (開発者X)
                                    </a>
                                </div>
                            </div>
                            <div class="help-item">
                                <h3>バグ報告・機能要望</h3>
                                <p>バグを発見した場合や新機能のご要望がございましたら、GitHubリポジトリのIssuesページよりお知らせください。</p>
                                <div style="margin: 10px 0;">
                                    <a href="https://github.com/AI-Kawaii-Project/KawAIi-Code/issues" target="_blank" style="color: #ff6b35; text-decoration: none; font-weight: 500;">
                                        GitHub Issues
                                    </a>
                                </div>
                            </div>
                            <div class="help-item">
                                <h3>ディスカッション・質問</h3>
                                <p>使い方に関する質問や機能についてのディスカッションは、GitHubのDiscussionsページをご利用ください。</p>
                                <div style="margin: 10px 0;">
                                    <a href="https://github.com/AI-Kawaii-Project/KawAIi-Code/discussions" target="_blank" style="color: #ff6b35; text-decoration: none; font-weight: 500;">
                                        GitHub Discussions
                                    </a>
                                </div>
                            </div>
                            <div class="help-item">
                                <h3>プロジェクト情報</h3>
                                <p>プロジェクトの最新情報やソースコードは、GitHubリポジトリでご確認いただけます。</p>
                                <div style="margin: 10px 0;">
                                    <a href="https://github.com/AI-Kawaii-Project/KawAIi-Code" target="_blank" style="color: #ff6b35; text-decoration: none; font-weight: 500;">
                                        GitHub リポジトリ
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- ライセンス -->
                        <div id="help-section-license" class="help-section">
                            <h2>ライセンス</h2>
                            <div class="help-item">
                                <div id="license-content" style="background: #f8f8f8; padding: 20px; border-radius: 8px; max-height: 600px; overflow-y: auto; font-size: 14px; border: 1px solid #e0e0e0;">
                                    <div style="text-align: center; color: #666;">読み込み中...</div>
                                </div>
                            </div>
                        </div>

                        <!-- プライバシーポリシー -->
                        <div id="help-section-privacy" class="help-section">
                            <h2>プライバシーポリシー</h2>
                            <div class="help-item">
                                <div id="privacy-content" style="background: #f8f8f8; padding: 20px; border-radius: 8px; max-height: 600px; overflow-y: auto; font-size: 14px; border: 1px solid #e0e0e0;">
                                    <div style="text-align: center; color: #666;">読み込み中...</div>
                                </div>
                            </div>
                        </div>

                        <!-- 利用規約 -->
                        <div id="help-section-terms" class="help-section">
                            <h2>利用規約</h2>
                            <div class="help-item">
                                <div id="terms-content" style="background: #f8f8f8; padding: 20px; border-radius: 8px; max-height: 600px; overflow-y: auto; font-size: 14px; border: 1px solid #e0e0e0;">
                                    <div style="text-align: center; color: #666;">読み込み中...</div>
                                </div>
                            </div>
                        </div>

                        <!-- アップデート情報 -->
                        <div id="help-section-updates" class="help-section">
                            <h2>アップデート情報</h2>
                            <div class="help-item">
                                <div id="updates-content" style="background: #f8f8f8; padding: 20px; border-radius: 8px; max-height: 600px; overflow-y: auto; font-size: 14px; border: 1px solid #e0e0e0;">
                                    <div style="text-align: center; color: #666;">読み込み中...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Claude Code Hooksモードガイド -->
        <div id="hooks-guide-modal" class="help-modal" style="display: none;">
            <div class="help-content">
                <div class="help-header">
                    <h3>Claude Code Hooksモードについて</h3>
                    <button id="close-hooks-guide" class="close-btn">×</button>
                </div>
                <div class="help-body">
                    <div class="help-section">
                        <h4>🔧 Claude Code Hooksモードとは</h4>
                        <div class="help-item">
                            <span class="help-icon">📡</span>
                            <strong>グローバル監視機能:</strong> このアプリ以外のターミナルやエディターでClaude Codeを使用した際も、音声読み上げとVRM表情連動が働きます。
                        </div>
                        <div class="help-item">
                            <span class="help-icon">🎭</span>
                            <strong>高度な感情分析:</strong> より詳細な感情分析により、キャラクターの表情がより自然で豊かに変化します。
                        </div>
                        <div class="help-item">
                            <span class="help-icon">🌐</span>
                            <strong>システム全体対応:</strong> どこでClaude Codeを起動しても、このアプリが連動して動作します。
                        </div>
                    </div>
                    
                    <div class="help-section">
                        <h4>📱 アプリ内のみモード vs 🔧 Hooksモード</h4>
                        <div class="help-item">
                            <span class="help-icon">📱</span>
                            <strong>アプリ内のみ（OFF）:</strong>
                            <ul>
                                <li>このアプリのターミナルでのみ動作</li>
                                <li>他のターミナルには影響しない</li>
                                <li>より安定した動作</li>
                                <li>リソース使用量が少ない</li>
                            </ul>
                        </div>
                        <div class="help-item">
                            <span class="help-icon">🔧</span>
                            <strong>Hooksモード（ON）:</strong>
                            <ul>
                                <li>システム全体のClaude Code活動を監視</li>
                                <li>外部ターミナルでも音声・表情連動</li>
                                <li>より豊かな感情表現</li>
                                <li>複数ターミナルで同時音声の可能性</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="help-section">
                        <h4>💡 使い分けの目安</h4>
                        <div class="help-item">
                            <span class="help-icon">🎯</span>
                            <strong>アプリ内のみがおすすめ:</strong>
                            <ul>
                                <li>このアプリだけでClaude Codeを使用</li>
                                <li>安定した動作を重視</li>
                                <li>他のアプリケーションに影響を与えたくない</li>
                            </ul>
                        </div>
                        <div class="help-item">
                            <span class="help-icon">⚡</span>
                            <strong>Hooksモードがおすすめ:</strong>
                            <ul>
                                <li>VSCode、Vim、別ターミナルでもClaude Codeを使用</li>
                                <li>どこでも音声・表情連動が欲しい</li>
                                <li>より豊かなキャラクター表現を楽しみたい</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="help-section">
                        <h4>⚠️ 注意事項</h4>
                        <div class="help-item">
                            <span class="help-icon">🔄</span>
                            <strong>同時実行:</strong> 複数のターミナルで同時にClaude Codeを使用すると、音声が重複する場合があります。
                        </div>
                        <div class="help-item">
                            <span class="help-icon">💻</span>
                            <strong>リソース:</strong> Hooksモードは常時監視のため、わずかにCPU使用量が増加します。
                        </div>
                        <div class="help-item">
                            <span class="help-icon">🔧</span>
                            <strong>設定切り替え:</strong> モード切り替えは設定画面からいつでも変更可能です。
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 会話ログ表示モーダル（一時的に無効化）
        <div id="stats-log-modal" class="help-modal" style="display: none;">
            <div class="help-content">
                <div class="help-header">
                    <h3>会話ログ</h3>
                    <button id="close-stats-log" class="close-btn">×</button>
                </div>
                <div class="help-body">
                    <div class="help-section">
                        <div style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <select id="log-count-select" class="speaker-select">
                                <option value="10">最新10件</option>
                                <option value="20" selected>最新20件</option>
                                <option value="50">最新50件</option>
                                <option value="100">最新100件</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 10px; padding: 8px 12px; background: #fff8dc; border: 1px solid #e0d090; border-radius: 6px; font-size: 12px; color: #666;">
                            <span style="font-weight: bold;">※</span> 読み上げた内容のみ記録されます
                        </div>
                        <div id="log-content" style="background: #f8f8f8; padding: 20px; border-radius: 8px; max-height: 500px; overflow-y: auto; font-size: 14px; line-height: 1.6; border: 1px solid #e0e0e0;">
                            <div style="text-align: center; color: #666;">ログを読み込み中...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        -->
        
    </div>

    <!-- xterm.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-web-links@0.11.0/lib/addon-web-links.js"></script>
    
    <!-- Logger（最初に読み込み） -->
    <script src="utils/logger.js"></script>
    
    <!-- 定数管理（最初に読み込み） -->
    <script src="constants/app-constants.js"></script>
    
    <!-- ターミナルファクトリー -->
    <script src="utils/terminal-factory.js"></script>
    
    <!-- SimpleDuplicateCheckerクラス -->
    <script src="classes/SimpleDuplicateChecker.js"></script>
    <!-- MessageAccumulatorクラス -->
    <script src="classes/MessageAccumulator.js"></script>
    
    <!-- VoiceQueueクラス -->
    <script src="classes/VoiceQueue.js"></script>
    
    <!-- AudioServiceクラス -->
    <script src="services/AudioService.js"></script>
    
    <!-- HookServiceクラス -->
    <script src="services/HookService.js"></script>
    
    <!-- VRMIntegrationServiceクラス -->
    <script src="services/VRMIntegrationService.js"></script>
    
    <!-- TerminalServiceクラス -->
    <script src="services/TerminalService.js"></script>
    
    <!-- TabManagerDependenciesクラス -->
    <script src="classes/TabManagerDependencies.js"></script>
    
    <!-- TabManagerクラス -->
    <script src="classes/TabManager.js"></script>
    
    <!-- リソース管理 -->
    <script src="utils/resource-manager.js"></script>
    <script src="utils/memory-monitor.js"></script>
    
    <!-- 処理最適化 -->
    <script src="utils/processing-cache.js"></script>
    
    <!-- エラーハンドラー -->
    <script src="utils/error-handler.js"></script>
    
    <!-- 統一設定管理システム（最初に読み込み） -->
    <script src="modules/unified-config-manager.js"></script>
    
    <!-- モジュール -->
    <script src="modules/wallpaper-system.js"></script>
    <script src="modules/config-manager.js"></script>
    <script src="modules/speech-history-manager.js"></script>
    <script src="modules/ui-event-manager.js"></script>
    
    <!-- TerminalAppManager -->
    <script src="managers/TerminalAppManager.js"></script>
    
    <!-- App.js -->
    <script src="app.js"></script>
    
</body>
</html>
