# AI-Kawaii-Terminal 汎用化問題点

## 概要
現在のAI-Kawaii-Terminalを別ディレクトリでも動作させるために解決が必要な問題点をまとめます。

## Critical（必須対応）問題

### 1. Claude Code実行パス問題
**問題**: Claude Code実行パスがハードコードされている
- **ファイル**: `websocket-server.js:106, 187, 255`
- **問題箇所**: `/opt/homebrew/bin/claude` (macOS Homebrew専用)
- **ファイル**: `main.js:131`
- **問題箇所**: `'claude'` (PATH環境変数依存)
- **影響**: 環境によってClaude Codeが実行できない

**解決策**: 
- 環境変数で実行パスを設定
- 複数パスでの自動検出機能
- 設定画面での手動パス指定

### 2. VRM・アセットファイル参照問題
**問題**: アセットファイルが固定パスで参照されている
- **ファイル**: `VRMViewer.tsx:225, 369`
- **問題箇所**: `/idle_loop.vrma`, `/kotone_claude1.vrm`
- **ファイル**: `main.js:294`
- **問題箇所**: `path.join(__dirname, filename)`
- **影響**: 別ディレクトリではVRMファイルが読み込めない

**解決策**:
- アセットファイルをアプリ内蔵化
- 動的パス解決システム
- アセットフォルダの自動検出

### 3. Next.jsプロジェクトパス問題
**問題**: Next.jsプロジェクトのパスが固定
- **ファイル**: `main.js:59`
- **問題箇所**: `path.join(__dirname, 'ai-kawaii-nextjs')`
- **影響**: 別ディレクトリではNext.jsサーバーが起動しない

**解決策**:
- Next.jsプロジェクトのバンドル化
- 動的プロジェクト検出
- 設定による手動パス指定

### 4. 壁紙フォルダパス問題
**問題**: 壁紙フォルダが固定パス
- **ファイル**: `main.js:318, 343, 375`
- **問題箇所**: `path.join(__dirname, 'src', 'assets', 'wallpapers', 'user')`
- **影響**: 壁紙機能が使用できない

**解決策**:
- ユーザーディレクトリに壁紙フォルダ作成
- 動的フォルダ作成・参照システム

## Important（推奨対応）問題

### 5. ポート番号固定問題
**問題**: WebSocketとNext.jsのポートが固定
- **ファイル**: `main.js:64` - Next.js PORT: '3002'
- **ファイル**: `websocket-server.js:6` - WebSocket port: 8080
- **ファイル**: `Terminal.tsx:24` - 'ws://localhost:8080'
- **ファイル**: `index.html:36` - 'http://localhost:3002'
- **影響**: ポート競合時に動作しない

**解決策**:
- 動的ポート割り当て
- 設定ファイルでのポート指定
- ポート競合の自動回避

### 6. 音声サービス設定問題
**問題**: 音声サービスURLが固定
- **ファイル**: `voiceService.js:5`
- **問題箇所**: `'http://127.0.0.1:10101'`
- **影響**: 音声サービスの設定変更ができない

**解決策**:
- 環境変数での設定
- 設定画面での変更機能

### 7. Content Security Policy問題
**問題**: CSPが固定URL許可
- **ファイル**: `index.html:6`
- **問題箇所**: `http://localhost:3002`, `ws://localhost:8080`
- **影響**: ポート変更時にセキュリティエラー

**解決策**:
- 動的CSP生成
- 設定に応じたCSP更新

## 汎用化のための設定ファイル問題

### 8. CLAUDE.md・キャラクター設定問題
**問題**: プロジェクト固有の設定ファイル
- **ファイル**: `CLAUDE.md`, `character_setting/`
- **影響**: 別ディレクトリではキャラクター機能が使用できない

**解決策**:
- 設定ファイルの内蔵化
- ユーザー設定フォルダシステム
- 自動設定ファイル生成

## 修正優先度

### Phase 1（最優先）
1. Claude Code実行パス問題
2. VRM・アセットファイル参照問題
3. CLAUDE.md・キャラクター設定問題

### Phase 2（次優先）
1. Next.jsプロジェクトパス問題
2. ポート番号固定問題
3. 壁紙フォルダパス問題

### Phase 3（最終）
1. 音声サービス設定問題
2. Content Security Policy問題

## 実装方針

### 設定システム構築
- アプリ設定ファイル（app-config.json）
- ユーザー設定フォルダ（~/.ai-kawaii-config/）
- 初回起動時の自動セットアップ

### 動的パス解決
- 環境検出機能
- フォールバック機能
- 設定画面での手動設定

### バンドル化
- 必要アセットの内蔵
- Next.jsプロジェクトの統合
- 依存関係の最小化

これらの問題を解決することで、どこでも動作する汎用的なAI-Kawaii-Terminalが実現できます。