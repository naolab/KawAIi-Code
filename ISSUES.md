# 現在の問題点

## 🔊 音声関連の問題

### 1. 複数カッコ付きテキストの同時読み上げ
**問題**: かっこ付きのテキストが2つ以上出力されたときに、同時に読み上げてしまう

**詳細**:
- 複数の『』で囲まれたテキストが一度に処理される
- 音声の順序制御が不完全
- 同時再生により音声が重複して聞こえる

**原因推定**:
- `processQuotedTexts`メソッドの順次処理が機能していない
- 音声再生の非同期処理で待機処理が不十分
- `waitForAudioComplete`の実装に問題がある可能性

**影響**:
- 音声が聞き取りづらい
- ユーザー体験の低下

**優先度**: 高

---

### 2. ターミナルリサイズ時の音声重複再生
**問題**: 開発者用のコンソールログのサイズを変更したときに、アプリ上のターミナルのサイズが変わり、音声が重複して読み上げられる

**詳細**:
- ブラウザのDevToolsリサイズ → ターミナルリサイズ → 音声重複再生
- 既に読み上げたテキストも再度読み上げられる
- 音声履歴管理が正常に機能していない

**原因推定**:
- ターミナルリサイズイベントが音声処理をトリガーしている
- `speechHistory.isDuplicate`チェックが無効化されている
- `MessageAccumulator`が再度同じデータを処理している

**影響**:
- 同じ内容の音声が複数回再生される
- 音声履歴管理の機能が破綻

**優先度**: 高

---

## 🔧 修正提案

### 1. 音声キューイングシステムの実装
- 音声再生の順序制御を強化
- 前の音声が完全に終了してから次の音声を再生
- 音声再生状態の厳密な管理

### 2. ターミナルリサイズイベントの分離
- リサイズイベントと音声処理の分離
- 音声履歴の重複チェック強化
- `MessageAccumulator`の再処理防止

### 3. 音声履歴管理の改善
- 重複チェックの精度向上
- 音声再生状態の永続化
- デバッグ情報の充実

---

## 📊 技術的詳細

### 関連ファイル
- `src/app.js` - `processQuotedTexts`, `waitForAudioComplete`
- `src/modules/speech-history-manager.js` - 音声履歴管理
- `src/modules/ui-event-manager.js` - リサイズイベント処理

### 関連する処理フロー
1. ターミナルデータ受信 → `processTerminalData`
2. メッセージ蓄積 → `MessageAccumulator`
3. 音声テキスト抽出 → `processQuotedTexts`
4. 音声再生 → `speakText` → `playAudio`
5. 履歴管理 → `SpeechHistoryManager`

---

## 🎯 次のアクション

1. **音声キューイングシステム実装** (優先度: 高)
2. **ターミナルリサイズイベント修正** (優先度: 高)
3. **音声履歴管理強化** (優先度: 中)
4. **デバッグ情報充実** (優先度: 中)

---

*最終更新: 2025-07-17*